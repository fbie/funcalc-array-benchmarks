+#title: Parallel Funcalc Benchmarks

* Intro

We have benchmarked Funcalc on our benchmarking server.  We have benchmarked Funcalc with
[[https://github.com/popular-parallel-programming/funcalc-euses][converted spreadsheets from the EUSES corpus]] using the file ~benchmark.bat~.

The date at which the benchmarks have been run can be found in the file ~build.log~ in each folder.


* Meta-Statistics

How many arrays did the algorithm convert per sheet?

#+begin_src R :session :results value
  errs <- list.files(path="arrays", pattern="err", full.names=TRUE)
  lifts <- sapply(errs, (function (err) {
      for (line in scan(err, what = character(), sep = "\n")) {
          if (grepl("Lifted", line))
            return(line)
      }
  }))
  cbind(sapply(errs, function (x) { sub(".err", "", x)}), lifts)
#+end_src

#+RESULTS:
| arrays/02rise.xml                      | Lifted 1 intransitive, 0 transitive cell arrays.  |
| arrays/2000_places_School.xml            | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/2002Qvols.xml                   | Lifted 2 intransitive, 0 transitive cell arrays.  |
| arrays/2004_PUBLIC_BUGS_INVENTORY.xml     | Lifted 4 intransitive, 0 transitive cell arrays.  |
| arrays/Aggregate20Governanc#A8A51.xml  | Lifted 30 intransitive, 0 transitive cell arrays. |
| arrays/EducAge25.xml                   | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/financial-model-spreadsheet.xml | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/Financial-Projections.xml       | Lifted 5 intransitive, 0 transitive cell arrays.  |
| arrays/funding.xml                     | Lifted 6 intransitive, 0 transitive cell arrays.  |
| arrays/high_2003_belg.xml                | Lifted 3 intransitive, 1 transitive cell arrays.  |
| arrays/iste-cs-2003-modeling-sim.xml   | Lifted 2 intransitive, 0 transitive cell arrays.  |
| arrays/modeling-3.xml                  | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/MRP_Excel.xml                    | Lifted 44 intransitive, 6 transitive cell arrays. |
| arrays/notes5CMISB200SP04H2KEY.xml     | Lifted 3 intransitive, 0 transitive cell arrays.  |
| arrays/ny_emit99.xml                    | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/Test20Station20Powe#A90F3.xml   | Lifted 9 intransitive, 0 transitive cell arrays.  |
| arrays/Time.xml                        | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/v1tmp.xml                       | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/WasteCalendarCalculat#A843B.xml | Lifted 3 intransitive, 0 transitive cell arrays.  |

| arrays/02rise.xml                      | Lifted 1 intransitive, 0 transitive cell arrays.  |
| arrays/2000_places_School.xml            | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/2002Qvols.xml                   | Lifted 2 intransitive, 0 transitive cell arrays.  |
| arrays/2004_PUBLIC_BUGS_INVENTORY.xml     | Lifted 4 intransitive, 0 transitive cell arrays.  |
| arrays/Aggregate20Governanc#A8A51.xml  | Lifted 30 intransitive, 0 transitive cell arrays. |
| arrays/EducAge25.xml                   | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/financial-model-spreadsheet.xml | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/Financial-Projections.xml       | Lifted 5 intransitive, 0 transitive cell arrays.  |
| arrays/funding.xml                     | Lifted 6 intransitive, 0 transitive cell arrays.  |
| arrays/high_2003_belg.xml                | Lifted 3 intransitive, 1 transitive cell arrays.  |
| arrays/iste-cs-2003-modeling-sim.xml   | Lifted 2 intransitive, 0 transitive cell arrays.  |
| arrays/modeling-3.xml                  | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/MRP_Excel.xml                    | Lifted 44 intransitive, 6 transitive cell arrays. |
| arrays/notes5CMISB200SP04H2KEY.xml     | Lifted 3 intransitive, 0 transitive cell arrays.  |
| arrays/ny_emit99.xml                    | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/Test20Station20Powe#A90F3.xml   | Lifted 9 intransitive, 0 transitive cell arrays.  |
| arrays/Time.xml                        | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/v1tmp.xml                       | Lifted 0 intransitive, 0 transitive cell arrays.  |
| arrays/WasteCalendarCalculat#A843B.xml | Lifted 3 intransitive, 0 transitive cell arrays.  |


It seems that

1. cell arrays are in general smaller than we expected (< 64 cells); and
2. there are many cell arrays that would introduce cyclic dependencies when lifted.


* Initial Data Probing

Let's see how well we're doing.

#+begin_src R :session :results value
  file <- "MRP_Excel.xml"
  readLog <- function (prefix, file) {
      return (read.table(paste(prefix, "/", file, ".out", sep=""),
                         dec=".",
                         row.names=3,
                         col.names=c("iteration", "mode", "elapsed"),
                         skip=2,
                         stringsAsFactors=TRUE))
  }
  getElapsed <- function (x) {
      as.double(sapply(array[2], function (x) {
          return(sub(",", ".", sub("ms", "", x)))
      }))
  }
  array <- readLog("arrays", file)
  cbind(c("Mean", "StdDev"), c(mean(getElapsed(array)), sd(getElapsed(array))))
#+end_src

#+RESULTS:
| Mean   |           9.281517 |
| StdDev | 0.0701914899659237 |

#+begin_src R :session :results graphics :file plots/MRP_Excel_array_plot.png
  plot(getElapsed(array))
#+end_src

#+RESULTS:
[[file:plots/MRP_Excel_array_plot.png]]

#+begin_src R :session :results graphics :file plots/MRP_Excel_array_hist.png
  hist(getElapsed(array), freq=0.1)
#+end_src

#+RESULTS:
[[file:plots/MRP_Excel_array_hist.png]]
